<script type="text/javascript">
  $(document).ready(function(){
      $('#events_search').change(function(){
        window.location.href = window.location.pathname + "?event_id=" + $(this).val();
      });
  });
</script>
<table>
  <tr>
    <td>Start Date</td>
    <td> <%= text_field 'start','date' %></td>
    <td>End Date</td>
    <td><%= text_field 'end','date' %></td>
  </tr>
  <tr>
    <td>Event Organizer</td>
    <td><%=  %></td>
    <td>Event Title</td>
    <td><%=  %></td>    
  </tr>
</table>

<section id='records'>
	<% if current_user.roles.map(&:title).include?('Superuser') %>
		<div>
			Select Event:
      <%= select 'events','search',Refinery::Events::Event.all.collect{|e| [e.title,e.id]}, {:selected=>params[:event_id]} %>
      <div style="float:right;">
        <%= link_to 'Download', "/Report_#{current_user.id}.csv" %>
      </div>
		</div>
  <% else %>
		<div>
			Select Event:
      <%= select 'events','search',Refinery::Events::Event.where(:created_by=>current_user.id).collect{|e| [e.title,e.id]} %>
      <div style="float:right;">
        <%= link_to 'Download', "/Report_#{current_user.id}.csv" %>
      </div>
		</div>
	<% end %>

	<table width = "100%" border="1px">
		<tr>
			<td>S.No</td>
			<td>Date</td>
			<td>Ticket Types</td>
			<td>Contact Details</td>
			<td>Quantity</td>
			<td>Amount</td>
    </tr>
    <% count = 1 %>
    <% @transctions.each do |registration| %>
        <tr>
          <td><%= count %></td>
          <td><%= registration.created_at.strftime('%d/%m/%Y %H:%M:%S') %></td>
          <td><%= Refinery::Events::Ticket.find(registration.attendees.collect(&:ticket_id)).collect(&:ticket_name).join(',') %></td>
          <td>
            <% registration.attendees.first.contact.each do |hh| %>
              <%= hh[1] %><br>
            <% end %>
          </td>
          <td><%= registration.no_of_tickets %></td>
          <td><%= registration.total %></td>
          <% count = count + 1 %>
        </tr>
		<% end %>

	</table>
</section>
<aside id='actions'>
  <%= render 'actions' %>
</aside>
